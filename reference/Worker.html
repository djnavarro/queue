<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="A Worker manages an external R session and completes tasks."><title>R6 Class Representing a Worker — Worker • queue</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="R6 Class Representing a Worker — Worker"><meta property="og:description" content="A Worker manages an external R session and completes tasks."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">queue</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/queue.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/djnavarro/queue/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>R6 Class Representing a Worker</h1>
      <small class="dont-index">Source: <a href="https://github.com/djnavarro/queue/blob/HEAD/R/worker.R" class="external-link"><code>R/worker.R</code></a></small>
      <div class="d-none name"><code>Worker.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A <code>Worker</code> manages an external R session and completes tasks.</p>
    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>Worker</code> class interacts with an external R session, and possesses
methods that allow it to work with <code>Task</code> objects. At its core, the
class is a thin wrapper around a <code><a href="https://callr.r-lib.org/reference/r_session.html" class="external-link">callr::r_session</a></code> object, and in fact
the session object itself can be obtained by calling the
<code>get_worker_session()</code> method. In most cases this shouldn't be necessary
however, because <code>Worker</code> objects are typically created as part of a
<code>WorkerPool</code> that is managed by a <code>Queue</code>, and those higher level structures
use the methods exposed by the <code>Worker</code> object.</p>
    </div>
    <div class="section level2">
    <h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h2>
    
<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-Worker-new"><code>Worker$new()</code></a></p></li>
<li><p><a href="#method-Worker-get_worker_id"><code>Worker$get_worker_id()</code></a></p></li>
<li><p><a href="#method-Worker-get_worker_state"><code>Worker$get_worker_state()</code></a></p></li>
<li><p><a href="#method-Worker-get_worker_runtime"><code>Worker$get_worker_runtime()</code></a></p></li>
<li><p><a href="#method-Worker-get_worker_task"><code>Worker$get_worker_task()</code></a></p></li>
<li><p><a href="#method-Worker-get_worker_session"><code>Worker$get_worker_session()</code></a></p></li>
<li><p><a href="#method-Worker-try_assign"><code>Worker$try_assign()</code></a></p></li>
<li><p><a href="#method-Worker-try_start"><code>Worker$try_start()</code></a></p></li>
<li><p><a href="#method-Worker-try_finish"><code>Worker$try_finish()</code></a></p></li>
<li><p><a href="#method-Worker-shutdown_worker"><code>Worker$shutdown_worker()</code></a></p></li>
<li><p><a href="#method-Worker-clone"><code>Worker$clone()</code></a></p></li>
</ul></div><p></p><hr><a id="method-Worker-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Create a new worker object.</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/Worker.html">Worker</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns">Returns<a class="anchor" aria-label="anchor" href="#returns"></a></h4>
<p>A new <code>Worker</code> object.</p>
</div>

</div><p></p><hr><a id="method-Worker-get_worker_id"></a><div class="section">
<h3 id="method-get-worker-id-">Method <code>get_worker_id()</code><a class="anchor" aria-label="anchor" href="#method-get-worker-id-"></a></h3>
<p>Retrieve the worker identifier.</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Worker</span><span class="op">$</span><span class="fu">get_worker_id</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-1">Returns<a class="anchor" aria-label="anchor" href="#returns-1"></a></h4>
<p>The worker identifier, which also the process id for the R session</p>
</div>

</div><p></p><hr><a id="method-Worker-get_worker_state"></a><div class="section">
<h3 id="method-get-worker-state-">Method <code>get_worker_state()</code><a class="anchor" aria-label="anchor" href="#method-get-worker-state-"></a></h3>
<p>Retrieve the worker state.</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Worker</span><span class="op">$</span><span class="fu">get_worker_state</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-2">Returns<a class="anchor" aria-label="anchor" href="#returns-2"></a></h4>
<p>A string specifying the current state of the R session. Possible
values are:</p><ul><li><p><code>"starting"</code>: the R session is starting up.</p></li>
<li><p><code>"idle"</code>: the R session is ready to compute.</p></li>
<li><p><code>"busy"</code>: the R session is computing.</p></li>
<li><p><code>"finished"</code>: the R session has terminated.</p></li>
</ul><p>Importantly, note that a task
function that is still running and a task function that is essentially
finished and waiting to return will both return "busy". To distinguish
between these two cases you need to use the <code>poll_process()</code> method of
a <code>callr::rsession</code>, as returned by <code>get_worker_session()</code>.</p>
</div>

</div><p></p><hr><a id="method-Worker-get_worker_runtime"></a><div class="section">
<h3 id="method-get-worker-runtime-">Method <code>get_worker_runtime()</code><a class="anchor" aria-label="anchor" href="#method-get-worker-runtime-"></a></h3>
<p>Return the total length of time the worker session
has been running, and the length of the time that the current task
has been running. If the session is finished both values are <code>NA</code>.
If the session is idle (no task running) the total session time will
return a value but the current task time will be <code>NA</code>.</p><div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Worker</span><span class="op">$</span><span class="fu">get_worker_runtime</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-3">Returns<a class="anchor" aria-label="anchor" href="#returns-3"></a></h4>
<p>A vector of two difftimes.</p>
</div>

</div><p></p><hr><a id="method-Worker-get_worker_task"></a><div class="section">
<h3 id="method-get-worker-task-">Method <code>get_worker_task()</code><a class="anchor" aria-label="anchor" href="#method-get-worker-task-"></a></h3>
<p>Retrieve the task assigned to the worker.</p><div class="section">
<h4 id="usage-4">Usage<a class="anchor" aria-label="anchor" href="#usage-4"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Worker</span><span class="op">$</span><span class="fu">get_worker_task</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-4">Returns<a class="anchor" aria-label="anchor" href="#returns-4"></a></h4>
<p>The <code>Task</code> object currently assigned to this <code>Worker</code>, or <code>NULL</code>.</p>
</div>

</div><p></p><hr><a id="method-Worker-get_worker_session"></a><div class="section">
<h3 id="method-get-worker-session-">Method <code>get_worker_session()</code><a class="anchor" aria-label="anchor" href="#method-get-worker-session-"></a></h3>
<p>Retrieve the R session associated with a <code>Worker</code></p><div class="section">
<h4 id="usage-5">Usage<a class="anchor" aria-label="anchor" href="#usage-5"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Worker</span><span class="op">$</span><span class="fu">get_worker_session</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-5">Returns<a class="anchor" aria-label="anchor" href="#returns-5"></a></h4>
<p>An R session object, see <code><a href="https://callr.r-lib.org/reference/r_session.html" class="external-link">callr::r_session</a></code></p>
</div>

</div><p></p><hr><a id="method-Worker-try_assign"></a><div class="section">
<h3 id="method-try-assign-">Method <code>try_assign()</code><a class="anchor" aria-label="anchor" href="#method-try-assign-"></a></h3>
<p>Attempt to assign a task to this worker. This method checks
that the task and the worker are both in an appropriate state. If they
are, both objects register their connection to the other. This method is
intended to be called by a <code>WorkerPool</code> or a <code>Queue</code>.</p><div class="section">
<h4 id="usage-6">Usage<a class="anchor" aria-label="anchor" href="#usage-6"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Worker</span><span class="op">$</span><span class="fu">try_assign</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>task</code></dt>
<dd><p>A <code>Task</code> object corresponding to the to-be-assigned task.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-6">Returns<a class="anchor" aria-label="anchor" href="#returns-6"></a></h4>
<p>Invisibly returns <code>TRUE</code> or <code>FALSE</code>, depending on whether the
attempt was successful.</p>
</div>

</div><p></p><hr><a id="method-Worker-try_start"></a><div class="section">
<h3 id="method-try-start-">Method <code>try_start()</code><a class="anchor" aria-label="anchor" href="#method-try-start-"></a></h3>
<p>Attempt to start the task. This method checks to see if the
that worker has an assigned task, and if so starts it running within the
R session. It also registers the change of status within the <code>Task</code>
object itself. This method is intended to be called by a <code>WorkerPool</code>
or a <code>Queue</code>.</p><div class="section">
<h4 id="usage-7">Usage<a class="anchor" aria-label="anchor" href="#usage-7"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Worker</span><span class="op">$</span><span class="fu">try_start</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-7">Returns<a class="anchor" aria-label="anchor" href="#returns-7"></a></h4>
<p>Invisibly returns <code>TRUE</code> or <code>FALSE</code>, depending on whether the
attempt was successful.</p>
</div>

</div><p></p><hr><a id="method-Worker-try_finish"></a><div class="section">
<h3 id="method-try-finish-">Method <code>try_finish()</code><a class="anchor" aria-label="anchor" href="#method-try-finish-"></a></h3>
<p>Attempt to finish a running task politely. This method checks
to see if the worker has a running task, and if so polls the R session to
determine if the R process claims to be ready to return. If there is a
ready-to-return task the results are read from the R process and returned
to the <code>Task</code> object. The task status is updated, and then unassigned
from the <code>Worker</code>. This method is intended to be called by a <code>WorkerPool</code>
or a <code>Queue</code>.</p><div class="section">
<h4 id="usage-8">Usage<a class="anchor" aria-label="anchor" href="#usage-8"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Worker</span><span class="op">$</span><span class="fu">try_finish</span><span class="op">(</span>timeout <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>timeout</code></dt>
<dd><p>Length of time to wait when process is polled (default = 0)</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-8">Returns<a class="anchor" aria-label="anchor" href="#returns-8"></a></h4>
<p>Invisibly returns <code>TRUE</code> or <code>FALSE</code>, depending on whether the
attempt was successful.</p>
</div>

</div><p></p><hr><a id="method-Worker-shutdown_worker"></a><div class="section">
<h3 id="method-shutdown-worker-">Method <code>shutdown_worker()</code><a class="anchor" aria-label="anchor" href="#method-shutdown-worker-"></a></h3>
<p>Attempt to shut down the R session gracefully, after making
an attempt to salvage any task that the worker believes it has been
assigned. The salvage operation depends on the state of the task. If the
<code>Task</code> has been assigned but not started, the <code>Worker</code> will return it
to a "waiting" state in the hope that the <code>Queue</code> will assign it to
another worker later, and unassign it. If the <code>Task</code> is running, the
<code>Worker</code> will attempt to read from the R session and then register the
<code>Task</code> as "done" regardless of the outcome. (The reason for this is to
ensure that tasks that crash or freeze the R session don't get returned
to the <code>Queue</code>).</p><div class="section">
<h4 id="usage-9">Usage<a class="anchor" aria-label="anchor" href="#usage-9"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Worker</span><span class="op">$</span><span class="fu">shutdown_worker</span><span class="op">(</span>grace <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>
<p></p><div class="arguments"><dl><dt><code>grace</code></dt>
<dd><p>Grace period in milliseconds. If the process is still
running after this period, it will be killed.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-Worker-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-10">Usage<a class="anchor" aria-label="anchor" href="#usage-10"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Worker</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Danielle Navarro.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

