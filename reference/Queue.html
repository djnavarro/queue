<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="A Queue executes tasks concurrently using multiple workers."><title>R6 Class Representing a Multi-Worker Task Queue — Queue • queue</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="R6 Class Representing a Multi-Worker Task Queue — Queue"><meta property="og:description" content="A Queue executes tasks concurrently using multiple workers."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">queue</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/queue.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/djnavarro/queue/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>R6 Class Representing a Multi-Worker Task Queue</h1>
      <small class="dont-index">Source: <a href="https://github.com/djnavarro/queue/blob/HEAD/R/queue.R" class="external-link"><code>R/queue.R</code></a></small>
      <div class="d-none name"><code>Queue.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A <code>Queue</code> executes tasks concurrently using multiple workers.</p>
    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>Queue</code> class is primary interface provided by the queue package. It
allows users to execute an arbitrary collection of tasks in parallel across
multiple R sessions, managed automatically in the background. Once a new
queue is initialised, tasks can be added to the queue using the <code>add()</code>
method. Once all tasks are added, they are executed in parallel
by calling the <code>run()</code> method. When completed, <code>run()</code> returns a
tibble that contains the results for all tasks, and some additional
metadata besides.</p>
<p>Internally, a <code>Queue</code> uses a <code>TaskList</code> object as its data store and a
<code>WorkerPool</code> object to execute the tasks in parallel. These objects can be
accessed by calling the <code>get_tasks()</code> method and the <code>get_workers()</code> methods.
Usually you would not need to do this, but occasionally it can be useful
because those objects have some handy methods that allow finer-grained
control (see the documentation for <code>TaskList</code> and <code>WorkerPool</code> respectively).</p>
    </div>
    <div class="section level2">
    <h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h2>
    
<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-Queue-new"><code>Queue$new()</code></a></p></li>
<li><p><a href="#method-Queue-add"><code>Queue$add()</code></a></p></li>
<li><p><a href="#method-Queue-run"><code>Queue$run()</code></a></p></li>
<li><p><a href="#method-Queue-get_workers"><code>Queue$get_workers()</code></a></p></li>
<li><p><a href="#method-Queue-get_tasks"><code>Queue$get_tasks()</code></a></p></li>
<li><p><a href="#method-Queue-clone"><code>Queue$clone()</code></a></p></li>
</ul></div><p></p><hr><a id="method-Queue-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Create a task queue</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/Queue.html">Queue</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>workers <span class="op">=</span> <span class="fl">4L</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>workers</code></dt>
<dd><p>Either the number of workers to employ in the task queue,
or a <code>WorkerPool</code> object to use when deploying the tasks.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns">Returns<a class="anchor" aria-label="anchor" href="#returns"></a></h4>
<p>A new <code>Queue</code> object</p>
</div>

</div><p></p><hr><a id="method-Queue-add"></a><div class="section">
<h3 id="method-add-">Method <code>add()</code><a class="anchor" aria-label="anchor" href="#method-add-"></a></h3>
<p>Adds a task to the queue</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Queue</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va">fun</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, id <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>fun</code></dt>
<dd><p>The function to be called when the task is scheduled</p></dd>


<dt><code>args</code></dt>
<dd><p>A list of arguments to be passed to the task function (optional)</p></dd>


<dt><code>id</code></dt>
<dd><p>A string specifying a unique identifier for the task (optional: tasks
will be named "task_1", "task_2", etc if this is unspecified)</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-1">Returns<a class="anchor" aria-label="anchor" href="#returns-1"></a></h4>
<p>Invisibly returns the <code>Task</code> object</p>
</div>

</div><p></p><hr><a id="method-Queue-run"></a><div class="section">
<h3 id="method-run-">Method <code>run()</code><a class="anchor" aria-label="anchor" href="#method-run-"></a></h3>
<p>Execute tasks in parallel using the worker pool, assigning
tasks to workers in the same order in which they were added to the queue</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Queue</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span></span>
<span>  timelimit <span class="op">=</span> <span class="fl">60</span>,</span>
<span>  message <span class="op">=</span> <span class="st">"minimal"</span>,</span>
<span>  interval <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  shutdown <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>
<p></p><div class="arguments"><dl><dt><code>timelimit</code></dt>
<dd><p>How long (in seconds) should the worker pool wait for a
task to complete before terminating the child process and moving onto the
next task? (default is 60 seconds, but this is fairly arbitrary)</p></dd>


<dt><code>message</code></dt>
<dd><p>What messages should be reported by the queue while it is
running? Options are "none" (no messages), "minimal" (a spinner is shown
alongside counts of waiting, running, and completed tasks), and "verbose"
(in addition to the spinner, each task is summarized as it completes).
Default is "minimal".</p></dd>


<dt><code>interval</code></dt>
<dd><p>How often should the task queue poll the workers to see
if they have finished their assigned tasks? Specified in seconds.</p></dd>


<dt><code>shutdown</code></dt>
<dd><p>Should the workers in the pool be shut down (i.e., all
R sessions closed) once the tasks are completed. Defaults to <code>TRUE</code>.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-2">Returns<a class="anchor" aria-label="anchor" href="#returns-2"></a></h4>
<p>Returns a tibble containing the results of all tasks and
various other useful metadata. Contains one row per task in the
<code>Queue</code>, and the following columns:</p><ul><li><p><code>task_id</code> A character string specifying the task identifiers</p></li>
<li><p><code>worker_id</code> An integer specifying the worker process ids (pid)</p></li>
<li><p><code>state</code> A character string indicating the status of each task
("created", "waiting", "assigned", "running", or "done")</p></li>
<li><p><code>result</code> A list containing the function outputs, or NULL</p></li>
<li><p><code>runtime</code> Completion time for the task (NA if the task is not done)</p></li>
<li><p><code>fun</code> A list containing the functions</p></li>
<li><p><code>args</code> A list containing the arguments passed to each function</p></li>
<li><p><code>created</code> The time at which each task was created</p></li>
<li><p><code>queued</code> The time at which each task was added to a <code>Queue</code></p></li>
<li><p><code>assigned</code> The time at which each task was assigned to a <code>Worker</code></p></li>
<li><p><code>started</code> The time at which a <code>Worker</code> called each function</p></li>
<li><p><code>finished</code> The time at which a <code>Worker</code> output was returned for the task</p></li>
<li><p><code>code</code> The status code returned by the callr R session (integer)</p></li>
<li><p><code>message</code> The message returned by the callr R session (character)</p></li>
<li><p><code>stdout</code> List column containing the contents of stdout during function execution</p></li>
<li><p><code>stderr</code> List column containing the contents of stderr during function execution</p></li>
<li><p><code>error</code>  List column containing <code>NULL</code> values</p></li>
</ul><p>Note: at present there is one field from the callr rsession::read() method
that isn't captured here, and that's the error field. I'll add that after
I've finished wrapping my head around what that actually does. The <code>error</code>
column, at present, is included only as a placeholder</p>
</div>

</div><p></p><hr><a id="method-Queue-get_workers"></a><div class="section">
<h3 id="method-get-workers-">Method <code>get_workers()</code><a class="anchor" aria-label="anchor" href="#method-get-workers-"></a></h3>
<p>Retrieve the workers</p><div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Queue</span><span class="op">$</span><span class="fu">get_workers</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-3">Returns<a class="anchor" aria-label="anchor" href="#returns-3"></a></h4>
<p>A <code>WorkerPool</code> object</p>
</div>

</div><p></p><hr><a id="method-Queue-get_tasks"></a><div class="section">
<h3 id="method-get-tasks-">Method <code>get_tasks()</code><a class="anchor" aria-label="anchor" href="#method-get-tasks-"></a></h3>
<p>Retrieve the tasks</p><div class="section">
<h4 id="usage-4">Usage<a class="anchor" aria-label="anchor" href="#usage-4"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Queue</span><span class="op">$</span><span class="fu">get_tasks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-4">Returns<a class="anchor" aria-label="anchor" href="#returns-4"></a></h4>
<p>A <code>TaskList</code> object</p>
</div>

</div><p></p><hr><a id="method-Queue-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-5">Usage<a class="anchor" aria-label="anchor" href="#usage-5"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Queue</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">queue</span> <span class="op">&lt;-</span> <span class="va">Queue</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>workers <span class="op">=</span> <span class="fl">4L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">wait</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span> <span class="va">queue</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va">wait</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">queue</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Queue complete: 6 tasks done in 1.7 secs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 × 17</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   task_id worker_id state result runtime        fun   args   created            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> <span style="color: #949494; font-style: italic;">&lt;drtn&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;lis&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> task_1       <span style="text-decoration: underline;">6</span>442 done  <span style="color: #949494;">&lt;NULL&gt;</span> 0.9304695 secs <span style="color: #949494;">&lt;fn&gt;</span>  &lt;list&gt; 2022-12-22 <span style="color: #949494;">00:51:11</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> task_2       <span style="text-decoration: underline;">6</span>456 done  <span style="color: #949494;">&lt;NULL&gt;</span> 0.9950504 secs <span style="color: #949494;">&lt;fn&gt;</span>  &lt;list&gt; 2022-12-22 <span style="color: #949494;">00:51:11</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> task_3       <span style="text-decoration: underline;">6</span>470 done  <span style="color: #949494;">&lt;NULL&gt;</span> 0.9944496 secs <span style="color: #949494;">&lt;fn&gt;</span>  &lt;list&gt; 2022-12-22 <span style="color: #949494;">00:51:11</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> task_4       <span style="text-decoration: underline;">6</span>484 done  <span style="color: #949494;">&lt;NULL&gt;</span> 0.9273577 secs <span style="color: #949494;">&lt;fn&gt;</span>  &lt;list&gt; 2022-12-22 <span style="color: #949494;">00:51:11</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> task_5       <span style="text-decoration: underline;">6</span>442 done  <span style="color: #949494;">&lt;NULL&gt;</span> 0.1153209 secs <span style="color: #949494;">&lt;fn&gt;</span>  &lt;list&gt; 2022-12-22 <span style="color: #949494;">00:51:11</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> task_6       <span style="text-decoration: underline;">6</span>484 done  <span style="color: #949494;">&lt;NULL&gt;</span> 0.7462354 secs <span style="color: #949494;">&lt;fn&gt;</span>  &lt;list&gt; 2022-12-22 <span style="color: #949494;">00:51:11</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with 9 more variables: queued &lt;dttm&gt;, assigned &lt;dttm&gt;, started &lt;dttm&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   finished &lt;dttm&gt;, code &lt;int&gt;, message &lt;chr&gt;, stdout &lt;list&gt;, stderr &lt;list&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   error &lt;list&gt;</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Danielle Navarro.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

